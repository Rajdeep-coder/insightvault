<%= turbo_stream_from @document %>

<!-- Full screen layout, fixed height, no outer scroll -->
<div class="h-screen w-screen overflow-hidden flex max-h-[93vh] bg-gray-100 font-sans">

  <!-- Document Section (70%) -->
  <div class="w-[70%] h-full overflow-y-auto px-8 py-6 bg-white border-r shadow-inner space-y-6">
    <!-- Title -->
    <h1 class="text-3xl font-semibold text-gray-900 mb-2 tracking-tight">
      <%= @document.title %>
    </h1>

    <!-- Extracted Text -->
    <div>
      <h2 class="text-lg font-medium text-gray-700 mb-2">Extracted Text</h2>
      <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 max-h-[300px] overflow-y-auto shadow-sm">
        <pre class="whitespace-pre-wrap text-sm leading-relaxed text-gray-800 font-mono">
<%= @document.extracted_text || "No text extracted yet." %>
        </pre>
      </div>
    </div>

    <!-- Summary Section -->
    <div class="space-y-4">
      <%= render partial: "documents/summary", locals: { document: @document } %>
    </div>
  </div>

  <!-- Chat Section (30%) -->
  <div class="w-[30%] h-full flex flex-col bg-gray-50 border-l px-4 py-6 space-y-4">
    <%= render partial: "documents/chat", locals: { document: @document } %>
  </div>
</div>

<!-- Auto-scroll chat on update -->
<script>
  document.addEventListener("turbo:before-stream-render", () => {
    setTimeout(() => {
      const chatBox = document.getElementById("document_<%= @document.id %>_chat_box");
      if (chatBox) {
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    }, 30);
  });
</script>
